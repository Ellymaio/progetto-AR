<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Test con Pulsante AR</title>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { width: 100%; height: 100%; }
        button {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background-color: red;
            color: white;
            border: none;
            cursor: pointer;
        }
        #error {
            position: absolute;
            top: 50px;
            left: 10px;
            color: red;
            font-size: 18px;
            display: none; /* Nasconde l'errore di default */
        }
    </style>
</head>
<body>

    <div id="error">Errore: impossibile accedere alla fotocamera!</div>

    <!-- Bottone per attivare la fotocamera AR -->
    <button id="arButton">Attiva AR</button>

    <a-scene embedded arjs="sourceType: webcam;" vr-mode-ui="enabled: false" debug>
        <!-- Marker predefinito Hiro -->
        <a-marker preset="hiro">
            <!-- Modello 3D o un cubo di esempio -->
            <a-box position="0 0.5 0" material="color: red;" scale="1 1 1" rotation="0 45 0" animation="property: rotation; to: 0 405 0; loop: true; dur: 4000"></a-box>
        </a-marker>
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Funzione per attivare la fotocamera AR
        document.getElementById('arButton').onclick = function() {
            // Verifica i permessi della fotocamera
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        // Se la fotocamera si avvia correttamente, nascondi il messaggio di errore
                        document.getElementById('error').style.display = 'none';
                        // Attiva l'Ar.js e la fotocamera
                        document.querySelector('a-scene').setAttribute('arjs', 'sourceType: webcam;');
                    })
                    .catch(function(err) {
                        // Se c'Ã¨ un errore, mostra il messaggio
                        document.getElementById('error').style.display = 'block';
                        console.error("Errore della fotocamera: ", err);
                    });
            }
        };
    </script>

</body>
</html>
